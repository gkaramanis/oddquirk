<!DOCTYPE html>
<html lang="en">

<head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-727326-24"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-727326-24');
</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Quirk - Tools</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="css/custom.css" rel="stylesheet">
  <!-- jQuery  -->
  <script src="vendor/jquery/jquery.min.js"></script>

  <!-- Vuejs, momentjs, elementUI -->
  <script src="https://unpkg.com/vue"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>

<body>

  <!-- Navigation -->
  <script>
    $.get("navigation.html", function(data) {
      $("#nav-placeholder").replaceWith(data);
    });
    $(document).ready(function() {
      $('a[href="' + this.location.pathname.slice(1) + '"]').parent().addClass('active');
       });
  </script>
  <div id="nav-placeholder"></div>

  <!-- Page Content -->
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-left">
        <h1 class="mt-5">Tabletträknare</h1>

        <div id="app" class="container-fluid">
          <div class="row">
            <div class="col-sm-6 well pr-4">
              <div class="row">
                <textarea class="form-control" v-on:input="parseInput" v-model="textInput" placeholder="Klistra in text eller skriv" rows="5"></textarea>
              </div>
              <div class="row">
                <p> Patienten tar <code>{{dailyDose}}</code> tabletter varje dag</br>
                  Det borde räcka för <code>{{enoughFor}}</code> dagar, till den <code>{{endDate}}</code></p>
              </div>
            </div>

            <div class="col-sm-6 well">
              <div class="row">
                <div class="col">
                    <label>
                <input v-model="dose" size="mini" :min="1" :max="10">
                  </input>
                  tabletter </label>
              </div>
                <div class="col">
                    <label>
                <input v-model="times" size="mini" :min="1" :max="10">
                </input>
                per dygn</label>
              </div>
              </div>

              <div class="row">
                <div class="col">
                    <div class="input-group">
                    <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">förpacning</span>
                <input v-model="packnum" size="mini" :min="1" :max="15">
                </input>
               </div>
               </div>
              </div>
              <div class="col">
                  <label>
                <input v-model="package" size="mini" :min="10" :max="100" :step="5">
                </input>
                st. </label>
              </div>

                <div class="col">
                    <label>
                <input v-model="refills" size="mini" :min="1" :max="8">
                </input>
                uttag</label>
                </p>
                </div>
              </div>

              <div class="row">
                <el-date-picker v-model="prescrDate" type="date" placeholder="Välj ett datum">
                </el-date-picker>
              </div>

            </div>
          </div>

        </div>

        <script>
          var app = new Vue({
            el: '#app',
            data: {
              textInput: '',
              dose: 1,
              times: 3,
              package: 25,
              packnum: 1,
              refills: 1
            },

            computed: {
              prescrDate: function() {
                return moment().subtract(30, 'days').format('YYYY-MM-DD');
              },
              endDate: function() {
                return moment(this.prescrDate).add(this.enoughFor, 'days').format('YYYY-MM-DD');
              },
              enoughFor: function() {
                return Math.round((this.packnum * this.package * this.refills) / (this.dose * this.times));
              },
              dailyDose: function() {
                return this.dose * this.times;
              }
            },
            methods: {
              parseInput: function(event) {
                dose_regex = /(\d+)-?(\d*)(\s+(tabl|kaps))/;
                times_regex = /(\d+)\s+gång/;
                timeofday_regex = /(till|på|kl)\s+(morgonen|frukost|lunch|kvällen|natten|\d{2}:\d{2})*/g; // g is needed here!;
                x_regex = /(\d+)x(\d+)/;
                // Find dose
                if (dose_regex.test(this.textInput)) {
                  dose_match = dose_regex.exec(this.textInput);
                  min_dose = dose_match[1];
                  max_dose = dose_match[2];
                  if (max_dose == "") {
                    this.dose = min_dose;
                  } else {
                    this.dose = max_dose;
                  }
                } else if (x_regex.test(this.textInput)) {
                  x_match = x_regex.exec(this.textInput);
                  this.dose = x_match[1];
                }

                if (times_regex.test(this.textInput)) {
                  times_match = times_regex.exec(this.textInput);
                  this.times = times_match[1]
                } else if (timeofday_regex.test(this.textInput)) {
                  times_match = this.textInput.match(timeofday_regex);
                  this.times = times_match.length;
                } else if (x_regex.test(this.textInput)) {
                  x_match = x_regex.exec(this.textInput);
                  this.times = x_match[2];
                }
              }
            }

          })
        </script>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>
